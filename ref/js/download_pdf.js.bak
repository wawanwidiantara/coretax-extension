document.addEventListener("DOMContentLoaded", () => { 
    const btn = document.getElementById("downloadBtn");

    btn.addEventListener("click", () => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF("p", "mm", "a4");

        // Judul
        doc.setFontSize(12);
        doc.text("Daftar Transaksi", 105, 15, { align: "center" });

        const margin = 4;
        const pageWidth = doc.internal.pageSize.getWidth();
        const usablePageWidth = pageWidth - margin * 2;

        const table = document.getElementById("dataTable");
        const headers = Array.from(table.querySelectorAll("th"));
        const rows = Array.from(table.querySelectorAll("tr"));

        // Ambil lebar kolom di layar
        const colScreenWidths = headers.map(th => th.offsetWidth);
        const totalScreenWidth = colScreenWidths.reduce((a,b) => a + b, 0);

        // Hitung lebar kolom PDF proporsional
        const columnWidths = colScreenWidths.map(w => usablePageWidth * (w / totalScreenWidth));

        // Buat columnStyles untuk autoTable
        const columnStyles = columnWidths.reduce((acc, width, idx) => {
            acc[idx] = { cellWidth: width, overflow: 'linebreak' };
            return acc;
        }, {});

        // Tabel PDF berbasis teks
        doc.autoTable({
            html: "#dataTable",
            startY: 25,
            theme: "grid",
            headStyles: { fillColor: [68, 114, 196] },
            styles: {
                fontSize: 6,
                cellPadding: 1,
                overflow: "linebreak",
            },
            columnStyles: columnStyles,
            tableWidth: "auto",
            margin: { left: margin, right: margin },
            pageBreak: "auto"
        });

        doc.save("Daftar Transaksi Efaktur.pdf");
    });
});
